<?xml version="1.0" encoding="UTF-8"?>
<recipe>
  <identifier>com.github.emetriq.autopkg.pdfsambasic.download</identifier>
  <description>Lädt das passende PDFsam Basic DMG für macOS (arm64 oder x64) und übernimmt den Original-Dateinamen.</description>
  <minimum_autopkg_version>2.3</minimum_autopkg_version>

  <input>
    <NAME>PDFsam Basic</NAME>
    <DOWNLOAD_PAGE_URL>https://pdfsam.org/de/download-pdfsam-basic/</DOWNLOAD_PAGE_URL>
    <!-- ARCH_TOKEN: arm64 (Apple Silicon) oder x64 (Intel) -->
    <ARCH_TOKEN>arm64</ARCH_TOKEN>
  </input>

  <process>
    <!-- Link zum passenden DMG (Version inkl. im Dateinamen) aus der Seite parsen -->
    <processor>URLTextSearcher</processor>
    <arguments>
      <url>%DOWNLOAD_PAGE_URL%</url>
      <re_pattern>href="(https://github\.com/torakiki/pdfsam/releases/download/[^"]+/pdfsam-basic-[^"]+-macos-%ARCH_TOKEN%\.dmg)"</re_pattern>
      <result_output_var_name>download_url</result_output_var_name>
    </arguments>

    <!-- DMG laden: KEIN filename gesetzt -> Original-Dateiname bleibt erhalten -->
    <processor>URLDownloader</processor>
    <arguments>
      <url>%download_url%</url>
    </arguments>

    <processor>EndOfCheckPhase</processor>
  </process>
</recipe>